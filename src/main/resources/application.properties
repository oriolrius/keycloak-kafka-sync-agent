# Quarkus Configuration
quarkus.application.name=keycloak-kafka-sync-agent

# HTTP Server
quarkus.http.port=57010

# Disable DevServices (we use custom configuration)
quarkus.kafka.devservices.enabled=false

# Datasource Configuration (SQLite)
# Database file location can be configured via SQLITE_DB_PATH environment variable
# Default: sync-agent.db in the current directory
quarkus.datasource.db-kind=sqlite
quarkus.datasource.jdbc.url=jdbc:sqlite:${SQLITE_DB_PATH:sync-agent.db}
quarkus.hibernate-orm.database.generation=none

# Flyway Migration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=classpath:db/migration

# Kafka Configuration (aligned with testing infrastructure)
# Can be overridden with environment variables: KAFKA_BOOTSTRAP_SERVERS, KAFKA_SECURITY_PROTOCOL, etc.
# PLAINTEXT is available on port 9092 for local testing
# SSL is available on port 57005 (host) -> 9093 (container) in testing infrastructure
kafka.bootstrap-servers=localhost:9092
kafka.security-protocol=PLAINTEXT
kafka.request-timeout-ms=30000
kafka.connection-timeout-ms=10000

# Kafka SASL Configuration (optional, for SASL_SSL or SASL_PLAINTEXT)
# Uncomment and configure when using SASL authentication
#kafka.sasl-mechanism=SCRAM-SHA-512
#kafka.sasl-jaas=org.apache.kafka.common.security.scram.ScramLoginModule required username="admin" password="admin-secret";

# Kafka SSL Configuration (for SSL or SASL_SSL protocols)
# Example for testing infrastructure with SSL:
#kafka.bootstrap-servers=localhost:57005
#kafka.security-protocol=SSL
#kafka.ssl-truststore-location=testing/certs/kafka.truststore.jks
#kafka.ssl-truststore-password=changeit
#kafka.ssl-keystore-location=testing/certs/kafka_broker.keystore.jks
#kafka.ssl-keystore-password=changeit
#kafka.ssl-key-password=changeit

# Keycloak Configuration (aligned with testing infrastructure)
# HTTPS-only on port 57003 (host) -> 8443 (container)
# Can be overridden with environment variables: KC_BASE_URL, KC_REALM, KC_CLIENT_ID, KC_CLIENT_SECRET, KC_WEBHOOK_HMAC_SECRET
keycloak.url=https://localhost:57003
keycloak.realm=master
keycloak.client-id=admin-cli
#keycloak.client-secret=your-client-secret-here
keycloak.admin-username=admin
keycloak.admin-password=The2password.
keycloak.connection-timeout-ms=10000
keycloak.read-timeout-ms=30000
# Webhook HMAC secret for validating incoming Keycloak Admin Events
# Required only if using webhook-based event processing
#keycloak.webhook-hmac-secret=your-webhook-secret-here

# Webhook Queue Configuration
# Controls the event processing queue for webhook events
# Can be overridden with environment variables: WEBHOOK_QUEUE_CAPACITY, WEBHOOK_QUEUE_OVERFLOW_STRATEGY
webhook.queue.capacity=1000
# Overflow strategy: REJECT (default) or DROP_OLDEST
webhook.queue.overflow-strategy=REJECT
# Number of async worker threads processing events
webhook.queue.worker-threads=2

# Webhook Retry Configuration
# Controls retry behavior for failed event processing
webhook.retry.max-attempts=3
# Base delay for exponential backoff (milliseconds)
webhook.retry.base-delay-ms=1000
# Maximum delay for exponential backoff (milliseconds)
webhook.retry.max-delay-ms=30000

# KMS Configuration (optional, for certificate management)
#kms.url=https://localhost:57001

# Metrics
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics
quarkus.micrometer.binder.jvm=true
quarkus.micrometer.binder.system=true
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder-enabled-default=true
quarkus.micrometer.registry-enabled-default=true
# Common tags for all metrics
quarkus.micrometer.export.prometheus.default-registry=true

# Health Checks
quarkus.smallrye-health.ui.enable=true
quarkus.smallrye-health.root-path=/health
quarkus.smallrye-health.liveness-path=/healthz
quarkus.smallrye-health.readiness-path=/readyz

# Circuit Breaker Configuration
# Controls fault tolerance behavior for Keycloak and Kafka connectivity
# Can be overridden with environment variables: CIRCUIT_BREAKER_FAILURE_THRESHOLD, CIRCUIT_BREAKER_DELAY, etc.
circuit-breaker.failure-threshold=5
circuit-breaker.delay-ms=60000
circuit-breaker.success-threshold=2
circuit-breaker.request-timeout-ms=5000

# Reconciliation Configuration
# Controls how often the agent reconciles Keycloak users with Kafka
# Can be overridden with environment variables: RECONCILE_INTERVAL_SECONDS, RECONCILE_PAGE_SIZE
reconcile.interval-seconds=120
reconcile.page-size=500

# Retention Configuration
# Controls database growth by purging old records based on time and space limits
# Can be overridden with environment variables: RETENTION_MAX_BYTES, RETENTION_MAX_AGE_DAYS, RETENTION_PURGE_INTERVAL_SECONDS
# Default max-bytes: 256 MB (268435456 bytes)
retention.max-bytes=268435456
retention.max-age-days=30
retention.purge-interval-seconds=300

# Server Configuration
# Can be overridden with environment variables: SERVER_PORT, DASHBOARD_BASIC_AUTH
# Note: quarkus.http.port is used instead of server.port for Quarkus compatibility
# server.port is kept for reference but quarkus.http.port takes precedence
#server.port=8088

# Dashboard Authentication Configuration
# Basic authentication for dashboard access (format: username:password)
# Can be overridden with DASHBOARD_BASIC_AUTH environment variable
# WARNING: If not set, dashboard will be accessible without authentication
#dashboard.basic-auth=admin:changeme

# Optional: Enable OIDC authentication via Keycloak (instead of Basic Auth)
# For testing, we'll keep it disabled initially and enable it after Keycloak is configured
dashboard.oidc-enabled=false
dashboard.oidc-required-role=dashboard-admin

# Quarkus OIDC Configuration (used when dashboard.oidc-enabled=true)
# This reuses the existing Keycloak connection for OIDC
quarkus.oidc.auth-server-url=${keycloak.url}/realms/${keycloak.realm}
quarkus.oidc.client-id=dashboard-client
quarkus.oidc.credentials.secret=${keycloak.client-secret:dashboard-secret}
quarkus.oidc.application-type=web-app
quarkus.oidc.roles.source=accesstoken
# Enable tenant for OIDC authentication
quarkus.oidc.tenant-enabled=true
# TLS verification - disable for local testing with self-signed certs
quarkus.oidc.tls.verification=none

# Logging
quarkus.log.level=INFO
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
